<main class="main-content space-y-10">
  <% tracks = @survey.track_list %>
  <% active = @survey.is_active? %>
  <% status_label, status_classes = if active
    ["Active", "inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700"]
  else
    ["Archived", "inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700"]
  end %>

  <header class="space-y-4">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-3">
        <div class="flex flex-wrap items-center gap-2">
          <span class="<%= status_classes %>"><%= status_label %></span>
          <span class="text-xs text-slate-500">Last updated <%= time_ago_in_words(@survey.updated_at) %> ago</span>
        </div>
        <h1 class="text-3xl font-semibold tracking-tight text-slate-900"><%= @survey.title %></h1>
        <p class="max-w-3xl text-sm text-slate-600">Fine-tune survey details, track assignments, and question prompts before publishing to advisors.</p>
        <dl class="flex flex-wrap gap-x-8 gap-y-2 text-xs text-slate-500">
          <div class="flex items-center gap-2">
            <dt class="font-semibold uppercase tracking-wide text-slate-600">Semester</dt>
            <dd class="text-slate-800"><%= @survey.semester.presence || "Unscheduled" %></dd>
          </div>
          <div class="flex items-center gap-2">
            <dt class="font-semibold uppercase tracking-wide text-slate-600">Created</dt>
            <dd class="text-slate-800"><%= l(@survey.created_at, format: :medium) %></dd>
          </div>
        </dl>
        <div class="flex flex-wrap gap-2">
          <% if tracks.present? %>
            <% tracks.each do |track| %>
              <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700"><%= track %></span>
            <% end %>
          <% else %>
            <span class="inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700">Unassigned to tracks</span>
          <% end %>
        </div>
      </div>

      <div class="flex flex-wrap justify-end gap-3">
        <%= link_to "Preview as student", preview_admin_survey_path(@survey), class: tailwind_button_classes(:subtle) %>
        <%= link_to "Manage surveys", admin_surveys_path, class: tailwind_button_classes(:secondary) %>
        <% if active %>
          <%= button_to "Archive survey", archive_admin_survey_path(@survey), method: :patch, data: { turbo_confirm: "Archive '#{@survey.title}' and remove it from advisors?" }, class: tailwind_button_classes(:subtle) %>
        <% else %>
          <%= button_to "Activate survey", activate_admin_survey_path(@survey), method: :patch, data: { turbo_confirm: "Make '#{@survey.title}' active for advisors?" }, class: tailwind_button_classes(:primary) %>
        <% end %>
      </div>
    </div>

    <div class="rounded-2xl border border-slate-200 bg-white px-5 py-4 text-sm text-slate-600 shadow-sm">
      <strong class="font-semibold text-slate-800">Tip:</strong> Use the form below to add or reorder categories, adjust question wording, and update track coverage. Every save logs an entry in the survey change history.
    </div>
  </header>

  <%= render "form", survey: @survey %>
</main>
