<% tracks = @survey.track_list %>
<% active = @survey.is_active? %>
<% status_label, status_classes = if active
  ["Active", "inline-flex items-center rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-700"]
else
  ["Archived", "inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700"]
end %>

<div class="survey-container survey-show mx-auto w-full space-y-8 px-4 sm:px-6 lg:px-4" style="max-width: 90rem;">
  <style>
    .survey-container [id^="survey-section-"],
    .survey-container [id^="survey-category-"],
    .survey-container .question-block {
      scroll-margin-top: 120px;
    }
    .survey-container .indented-description {
      border-left: 2px solid #e2e8f0;
      margin-left: 0.25rem;
      padding-left: 1rem;
    }
  </style>

  <div class="c-toolbar c-toolbar--spaced">
    <div class="c-toolbar__row justify-between w-full">
      <%= link_to "â† Back", admin_surveys_path, class: tailwind_button_classes(:secondary) %>

      <div class="flex flex-wrap justify-end gap-3">
        <%= link_to "Preview as student", preview_admin_survey_path(@survey), class: tailwind_button_classes(:subtle) %>
        <% if active %>
          <%= button_to "Archive survey", archive_admin_survey_path(@survey), method: :patch, data: { turbo_confirm: "Archive '#{@survey.title}' and remove it from advisors?" }, class: tailwind_button_classes(:subtle) %>
        <% else %>
          <%= button_to "Activate survey", activate_admin_survey_path(@survey), method: :patch, data: { turbo_confirm: "Make '#{@survey.title}' active for advisors?" }, class: tailwind_button_classes(:primary) %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="c-card survey-header space-y-3">
    <div class="flex flex-wrap items-center gap-2">
      <span class="<%= status_classes %>"><%= status_label %></span>
      <span class="text-xs text-slate-500">Last updated <%= time_ago_in_words(@survey.updated_at) %> ago</span>
    </div>

    <h1 class="text-2xl font-semibold tracking-tight text-slate-900"><%= @survey.title %></h1>
    <p class="text-sm text-slate-600">Fine-tune survey details, track assignments, and question prompts before publishing to advisors.</p>

    <dl class="flex flex-wrap gap-x-8 gap-y-2 text-xs text-slate-500">
      <div class="flex items-center gap-2">
        <dt class="font-semibold uppercase tracking-wide text-slate-600">Semester</dt>
        <dd class="text-slate-800"><%= @survey.semester.presence || "Unscheduled" %></dd>
      </div>
      <div class="flex items-center gap-2">
        <dt class="font-semibold uppercase tracking-wide text-slate-600">Due date</dt>
        <dd class="text-slate-800"><%= @survey.due_date.present? ? format_calendar_date(@survey.due_date) : "No due date" %></dd>
      </div>
      <div class="flex items-center gap-2">
        <dt class="font-semibold uppercase tracking-wide text-slate-600">Created</dt>
        <dd class="text-slate-800"><%= l(@survey.created_at, format: :medium) %></dd>
      </div>
    </dl>

    <div class="flex flex-wrap gap-2">
      <% if tracks.present? %>
        <% tracks.each do |track| %>
          <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-700"><%= track %></span>
        <% end %>
      <% else %>
        <span class="inline-flex items-center rounded-full bg-amber-100 px-3 py-1 text-xs font-semibold text-amber-700">Unassigned to tracks</span>
      <% end %>
    </div>
  </div>

  <%= render "form", survey: @survey %>
</div>
