# üß≠ Copilot Instructions ‚Äî Survey Management System

You are helping implement a **Survey Management Feature** in a **Ruby on Rails 7** application.  
The app runs inside **Docker**, and all Rails commands must be executed as:

docker compose run --rm bin/rails <command>


Use this command pattern for migrations, generators, model creation, and other setup steps.

Only use tailwind native classes and do not add more custom css styling.

---

## üß© Feature Overview

Implement a **Canvas-like Survey Builder** for **admin users** to create, edit, and manage surveys for students.  
Each survey is completed once per semester by **master‚Äôs students**, organized by **student track** (e.g., Residential, Executive).

Admins can:
- Create and edit surveys with multiple categories (competency areas)
- Add and organize questions
- Assign surveys to groups of students
- Preview the survey as a student
- Archive or delete surveys
- View detailed change logs of every admin action

---

## ‚öôÔ∏è Models to Define

Define and relate the following models:

### `User`
- Base user model (has role: admin, advisor, student)

### `Survey`
- `title:string`
- `description:text`
- `is_active:boolean` (default: true)
- `created_by:references (User)`
- Associations:
  - has_many :categories, dependent: :destroy
  - has_many :survey_assignments, dependent: :destroy
  - has_many :survey_change_logs, dependent: :destroy

### `Category`
- `name:string`
- `survey:references`
- has_many :questions, dependent: :destroy

### `Question`
- `category:references`
- `question_text:text`
- `response_type:string` (text, multiple_choice, likert, file_upload)
- `is_required:boolean`
- `has_evidence_field:boolean`

### `SurveyAssignment`
- `survey:references`
- `track:string` (e.g., "Residential", "Executive")
- Each student in that track gets access once per semester.

### `SurveyChangeLog`
- `admin:references (User)`
- `survey:references`
- `action:string` (create, update, assign, archive, delete)
- `description:text`
- `created_at:datetime`

Add `dependent: :destroy` and proper foreign key constraints.  
For audit tracking, log all admin actions that affect surveys or related models.

---

## üß† Access Control

- Only **Admins** can:
  - Create, edit, delete, assign, or archive surveys.
- **Advisors** can view surveys but not edit them.
- **Students** can only view surveys assigned to their track and submit responses (handled elsewhere).

Use **Pundit** or **CanCanCan** if available.

---

## üñ•Ô∏è Frontend Behavior

### Survey Index Page (Admin)
- Displays **Active Surveys** with:
  - Title, Semester, Assigned Tracks, Question Count, Created Date
- Actions available:
  - **Preview** (student view)
  - **Edit**
  - **Assign to tracks**
  - **Archive**
  - **Delete**
- Archived surveys appear in a **Deactivated** section.

### Survey Builder Page
- Functions similar to **Canvas Quiz Editor**.
- Provides a dynamic and user-friendly interface for building and organizing survey content.
- Admin can:
  - Add or remove **categories** (competency areas).
  - Add or remove **questions** within categories.
  - Edit **question text**, **response type**, and **required/evidence flags**.
  - **Reorder** questions or categories via drag-and-drop.
  - **Auto-save** edits or manually click ‚ÄúSave Changes.‚Äù

- Each question includes a **question type**, defined as an enum in the `Question` model:

  ```ruby
  enum :question_type, {
    multiple_choice: "multiple_choice",
    scale: "scale",
    short_answer: "short_answer",
    evidence: "evidence"
  }, prefix: true
  ```
- The builder UI must dynamically adjust based on the selected question_type:
    - multiple_choice ‚Üí show a list editor for options (add/remove/edit choices)
    - scale ‚Üí show numeric range or Likert scale configuration
    - short_answer ‚Üí show a single-line text input preview
    - evidence ‚Üí show google drive link upload and supporting link validation
- Additional behavior:
    - Allow toggling Required and Has Evidence Field flags.
    - Support inline validation (e.g., disallow blank question text).
    - Show real-time feedback for unsaved changes and success confirmations.
    - Maintain responsive layout for usability on both desktop and tablet.
- Backend behavior:
    - Save changes immediately via AJAX or Turbo Streams, or on manual ‚ÄúSave Changes.‚Äù
    - Each admin edit or structural change (add/remove/move question/category) must trigger a SurveyChangeLog entry describing the action.

### Survey Preview
- Read-only ‚Äústudent mode‚Äù preview.
- Admin cannot submit answers.

### Audit Log Page
- Lists all actions in reverse chronological order.
- Columns: Timestamp, Admin, Action, Description.
- Allow filtering by survey or action type.

---

## üîê Functional Requirements

- Archiving a survey:
  - Sets `is_active = false`
  - Unassigns from all student groups
  - Moves it to the ‚ÄúDeactivated‚Äù section
- Deleting a survey requires confirmation.
- Assigning a survey attaches it to one or more `tracks`.

---

## ‚úÖ Acceptance Criteria

### Survey Creation
- [ ] Admin can create new surveys with multiple categories and questions.
- [ ] Each question supports different response types and optional evidence fields.
- [ ] Surveys are saved and appear in the active survey list.

### Survey Editing
- [ ] Admin can modify title, categories, and questions.
- [ ] Admin can move questions between categories.
- [ ] Auto-save or explicit ‚ÄúSave Changes‚Äù supported.

### Survey Assignment
- [ ] Admin can assign a survey to tracks (Residential, Executive).
- [ ] Students in that track can only see assigned surveys.

### Survey Archiving & Deletion
- [ ] Admin can archive surveys, removing assignments.
- [ ] Archived surveys appear in a separate list.
- [ ] Delete requires confirmation prompt.

### Survey Preview
- [ ] Admin can preview surveys exactly as students see them, without submission rights.

### Audit Log
- [ ] All admin actions (create, edit, assign, archive, delete) are recorded with timestamps.
- [ ] Logs are viewable and filterable by survey and admin.

### Access Control
- [ ] Only Admins can manage surveys.
- [ ] Advisors and Students have read-only access to appropriate sections.

---

## üß∞ Implementation Notes

- Use **Turbo Frames** and **Stimulus** for dynamic UI inside Rails, or **React** if enabled.
- Use **Active Storage** for evidence file uploads.
- Migrations must include foreign keys.
- Include sample seeds for testing (2 surveys, 2 tracks, 3 admins).
- Add Docker command examples in documentation comments for each generator.

---