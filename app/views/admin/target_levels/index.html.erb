<main class="main-content">
  <section class="c-card dashboard-section">
    <div class="section-header">
      <h1 class="section-title">Target Levels</h1>
      <p class="section-subtitle">Set program target levels per competency, semester, track, and year.</p>
    </div>

    <%= form_with url: admin_target_levels_path, method: :get, local: true, data: { turbo: false } do %>
      <div class="c-card c-card--tight mb-6">
        <div class="flex flex-wrap items-end gap-4">
          <div class="min-w-[14rem]">
            <label class="block text-sm font-medium text-slate-700">Semester</label>
            <%= select_tag :program_semester_id,
              options_from_collection_for_select(@semesters, :id, :name, @selected_semester_id),
              class: "mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",
              onchange: "this.form.submit()" %>
          </div>

          <div class="min-w-[12rem]">
            <label class="block text-sm font-medium text-slate-700">Track</label>
            <%= select_tag :track,
              options_for_select(@tracks, @selected_track),
              class: "mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",
              onchange: "this.form.submit()" %>
          </div>

          <div class="min-w-[10rem]">
            <label class="block text-sm font-medium text-slate-700">Year</label>
            <%= select_tag :program_year,
              options_for_select(@program_year_options, @selected_program_year.to_s),
              class: "mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm",
              onchange: "this.form.submit()" %>
          </div>
        </div>
      </div>
    <% end %>

    <%= form_with url: admin_target_levels_path, method: :patch, local: true, data: { turbo: false } do %>
      <%= hidden_field_tag :program_semester_id, @selected_semester_id %>
      <%= hidden_field_tag :track, @selected_track %>
      <%= hidden_field_tag :program_year, @selected_program_year %>

      <div class="c-card c-card--flush c-table-wrapper">
        <table class="c-table">
          <thead>
            <tr>
              <th style="min-width: 28rem;">Competency</th>
              <th style="min-width: 10rem;">Target (1-5)</th>
            </tr>
          </thead>
          <tbody>
            <% @competencies.each_with_index do |title, idx| %>
              <tr>
                <td>
                  <div class="font-medium text-slate-900"><%= title %></div>
                </td>
                <td>
                  <%= hidden_field_tag "targets[#{idx}][competency_title]", title %>
                  <%= render "shared/proficiency_select",
                             name: "targets[#{idx}][target_level]",
                             selected: @targets_by_title[title].to_s,
                             class_name: "w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500" %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>

      <div class="c-card c-card--tight mt-6 flex flex-wrap items-center justify-end gap-3">
        <%= link_to "â† Back", admin_dashboard_path, class: tailwind_button_classes(:secondary), data: { turbo: false } %>
        <%= submit_tag "Save Target Levels", class: tailwind_button_classes(:primary) %>
      </div>
    <% end %>
  </section>
</main>
