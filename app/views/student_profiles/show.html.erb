<% content_for :title, "Student Profile" %>

<% full_name = @student.full_name.presence || @student.user&.name || "Student" %>
<% email = @student.email %>
<% uin = @student.uin.presence || "Not provided" %>
<% track = @student.track.present? ? @student.track.to_s.titleize : "Not assigned" %>
<% class_of = @student.program_year.present? ? "Class of #{@student.program_year}" : "Not set" %>
<% major = @student.major.presence || "Program TBD" %>
<% advisor_name = @student.advisor&.name || "Advisor pending" %>
<% member_since = @student.created_at ? @student.created_at.strftime("%b %-d, %Y") : "Recently" %>
<% updated_text = @student.updated_at ? time_ago_in_words(@student.updated_at) + " ago" : "Just now" %>
<% initials = full_name.split.first(2).map { |part| part.first&.upcase }.join.presence || "ST" %>
<% avatar_url = @student.avatar_url.presence %>

<div class="py-6 sm:py-8">
  <div class="u-stack u-stack--lg">
    <section class="c-hero c-hero--maroon c-hero--compact">
      <div class="flex flex-col gap-10 lg:flex-row lg:items-start lg:justify-between">
        <div class="space-y-8">
          <div class="space-y-4">
            <p class="c-eyebrow c-eyebrow--inverse">Your student profile</p>
            <h1 class="c-h1 c-h1--inverse"><%= full_name %></h1>
            <p class="c-lede c-lede--inverse max-w-2xl">Track your program status, advisor, and key milestones.</p>
          </div>

          <div class="flex flex-wrap gap-3">
            <span class="c-pill c-pill--inverse">
              <span class="c-pill__dot c-pill__dot--inverse"></span>
              Track Â· <%= track %>
            </span>
            <span class="c-pill c-pill--inverse">
              Cohort member since <%= member_since %>
            </span>
            <span class="c-pill c-pill--inverse">
              Updated <%= updated_text %>
            </span>
          </div>
        </div>

        <div class="flex flex-col gap-8 sm:flex-row sm:items-start lg:flex-col lg:items-end">
          <div class="space-y-5">
            <div>
              <p class="c-eyebrow c-eyebrow--inverse">Primary email</p>
              <p class="c-value c-value--xl c-value--inverse"><%= email %></p>
            </div>
            <div>
              <p class="c-eyebrow c-eyebrow--inverse">Advisor</p>
              <p class="c-value c-value--xl c-value--inverse"><%= advisor_name %></p>
            </div>
          </div>
          <div class="c-avatar-tile c-avatar-tile--inverse h-24 w-24 text-xl" <%= "role=\"img\" aria-label=\"#{avatar_aria_label(@student.user)}\"" unless avatar_url %>>
            <% if avatar_url %>
              <img src="<%= avatar_url %>" alt="<%= avatar_aria_label(@student.user) %>" loading="lazy">
            <% else %>
              <span aria-hidden="true"><%= initials %></span>
              <span class="sr-only"><%= avatar_aria_label(@student.user) %></span>
            <% end %>
          </div>
        </div>
      </div>

      <div class="mt-6 grid gap-4 md:grid-cols-3">
        <article class="c-kv c-kv--inverse c-kv--compact">
          <p class="c-eyebrow c-eyebrow--inverse">Major / Program</p>
          <p class="c-value c-value--xl c-value--inverse"><%= major %></p>
        </article>
        <article class="c-kv c-kv--inverse c-kv--compact">
          <p class="c-eyebrow c-eyebrow--inverse">UIN</p>
          <p class="c-value c-value--xl c-value--inverse"><%= uin %></p>
        </article>
        <article class="c-kv c-kv--inverse c-kv--compact">
          <p class="c-eyebrow c-eyebrow--inverse">Program year</p>
          <p class="c-value c-value--xl c-value--inverse"><%= class_of %></p>
        </article>
      </div>
    </section>

    <div>
      <section class="c-card c-card--tight space-y-8">
        <header class="space-y-2">
          <p class="c-eyebrow">Overview</p>
          <h2 class="c-h2">Profile details</h2>
        </header>

        <div class="space-y-8">
          <div class="space-y-4">
            <p class="c-h3">Personal</p>
            <dl class="grid gap-4 sm:grid-cols-2">
              <div class="c-kv c-kv--compact">
                <dt class="c-eyebrow">Full name</dt>
                <dd class="c-value c-value--lg"><%= full_name %></dd>
              </div>
              <div class="c-kv c-kv--compact">
                <dt class="c-eyebrow">UIN</dt>
                <dd class="c-value c-value--lg"><%= uin %></dd>
              </div>
              <div class="c-kv c-kv--compact sm:col-span-2">
                <dt class="c-eyebrow">Email</dt>
                <dd class="c-value c-value--lg"><%= email %></dd>
              </div>
            </dl>
          </div>

          <div class="space-y-4 border-t border-slate-100 pt-6">
            <p class="c-h3">Academic</p>
            <dl class="grid gap-4 sm:grid-cols-2">
              <div class="c-kv c-kv--compact">
                <dt class="c-eyebrow">Major / Program</dt>
                <dd class="c-value c-value--lg"><%= major %></dd>
              </div>
              <div class="c-kv c-kv--compact">
                <dt class="c-eyebrow">Program year</dt>
                <dd class="c-value c-value--lg"><%= class_of %></dd>
              </div>
              <div class="c-kv c-kv--compact">
                <dt class="c-eyebrow">Program track</dt>
                <dd class="c-value c-value--lg"><%= track %></dd>
              </div>
              <div class="c-kv c-kv--compact sm:col-span-2">
                <dt class="c-eyebrow">Advisor</dt>
                <dd class="c-value c-value--lg"><%= advisor_name %></dd>
              </div>
            </dl>
          </div>
        </div>

        <div class="u-actions u-actions--split border-t border-slate-100 pt-6">
          <%= link_to student_dashboard_path, class: tailwind_button_classes(:secondary) do %>
            Back to dashboard
          <% end %>

          <%= link_to edit_student_profile_path, class: tailwind_button_classes(:primary) do %>
            Edit profile
          <% end %>
        </div>
      </section>
    </div>
  </div>
</div>
