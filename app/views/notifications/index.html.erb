<% content_for :title, "Notifications" %>

<div class="mx-auto max-w-3xl space-y-6">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold text-slate-900">Notifications</h1>
    <% if @unread_notification_count.to_i.positive? %>
      <%= button_to "Mark all as read",
                    mark_all_read_notifications_path,
                    method: :patch,
                    class: "rounded-md bg-slate-800 px-4 py-2 text-sm font-medium text-white shadow hover:bg-slate-700" %>
    <% end %>
  </div>

  <% if @notifications.blank? %>
    <p class="rounded-md border border-dashed border-slate-300 bg-white p-6 text-center text-slate-500">
      You're all caught up! New notifications will appear here when available.
    </p>
  <% else %>
    <div class="divide-y divide-slate-200 overflow-hidden rounded-lg border border-slate-200 bg-white">
      <% @notifications.each do |notification| %>
        <% item_classes = notification.read? ? "bg-white" : "bg-slate-50" %>
        <article class="#{item_classes} transition hover:bg-slate-100">
          <%= link_to notification_path(notification), class: "block px-5 py-4" do %>
            <div class="flex items-start justify-between gap-3">
              <div>
                <h2 class="text-sm font-semibold text-slate-900">
                  <%= notification.title %>
                  <% unless notification.read? %>
                    <span class="ml-2 inline-flex h-2 w-2 rounded-full bg-blue-500 align-middle"></span>
                  <% end %>
                </h2>
                <p class="mt-1 text-sm text-slate-600">
                  <%= truncate(notification.message, length: 120) %>
                </p>
                <% if notification.target_path_for(current_user).present? %>
                  <p class="mt-2 text-xs font-medium text-blue-600">View related record →</p>
                <% end %>
              </div>
              <time class="shrink-0 text-xs text-slate-500">
                <%= time_ago_in_words(notification.created_at) %> ago
              </time>
            </div>
          <% end %>
        </article>
      <% end %>
    </div>

    <% if @total_pages > 1 %>
      <nav class="flex items-center justify-between pt-4 text-sm text-slate-600">
        <% prev_page = @page - 1 %>
        <% next_page = @page + 1 %>
        <div>
          <% if prev_page >= 1 %>
            <%= link_to "← Previous", notifications_path(page: prev_page), class: "hover:text-slate-800" %>
          <% end %>
        </div>
        <p>Page <%= @page %> of <%= @total_pages %></p>
        <div>
          <% if next_page <= @total_pages %>
            <%= link_to "Next →", notifications_path(page: next_page), class: "hover:text-slate-800" %>
          <% end %>
        </div>
      </nav>
    <% end %>
  <% end %>
</div>
