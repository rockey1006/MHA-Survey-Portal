<!-- Login Navigation Header -->
<header class="app-header" role="banner">
  <div class="header-content">
    <div class="header-left">
      <div class="logo" aria-label="Texas A&amp;M University">
        <div class="logo-icon" aria-hidden="true"></div>
        <div class="logo-text">
          TEXAS A&M<br>
          UNIVERSITY
        </div>
      </div>

      <nav class="nav-links" aria-label="Primary">
        <%= link_to "Home", root_path, class: "nav-link" %>

        <!-- About page (documentation landing) -->
        <%= link_to "About the Portal", about_path, class: "nav-link" %>

        <!-- FAQ page -->
        <%= link_to "FAQ", faq_path, class: "nav-link" %>
      </nav>
    </div>

    <div class="user-section">
      <!-- High contrast toggle -->
      <button
        type="button"
        class="btn btn-secondary"
        data-high-contrast-toggle="true"
        aria-pressed="false"
        aria-label="Toggle high contrast mode">
        High Contrast: Off
      </button>

      <!-- Text-to-speech toggle -->
      <button
        type="button"
        class="btn btn-secondary"
        data-tts-toggle="true"
        aria-pressed="false"
        aria-label="Read this page aloud">
        Read Page Aloud
      </button>

      <a href="https://public-health.tamu.edu/degrees/hpm/mha/index.html"
         class="btn btn-secondary">
        Program Overview
      </a>

      <div class="sign-in-launcher" data-signin-menu>
        <button type="button"
                class="btn btn-primary sign-in-launcher__button"
                data-signin-trigger
                aria-haspopup="true"
                aria-expanded="false"
                aria-controls="sign-in-menu-panel">
          Sign In
          <span aria-hidden="true">‚ñæ</span>
        </button>
        <div class="sign-in-launcher__panel"
             id="sign-in-menu-panel"
             data-signin-panel
             hidden
             role="menu"
             aria-label="Choose a role to sign in">
          <p class="sign-in-launcher__label">Pick the dashboard you need:</p>
          <button type="button"
                  class="sign-in-launcher__option"
                  data-login-role="student"
                  role="menuitem">
            <span>üéì Student access</span>
            <span class="sign-in-launcher__chevron">‚Üí</span>
          </button>
          <button type="button"
                  class="sign-in-launcher__option"
                  data-login-role="advisor"
                  role="menuitem">
            <span>üßë‚Äçüè´ Advisor access</span>
            <span class="sign-in-launcher__chevron">‚Üí</span>
          </button>
          <a href="<%= new_user_session_path %>"
             class="sign-in-launcher__link"
             role="menuitem">
          </a>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  (function () {
    function bootNavbarLogin() {
      var links = document.querySelectorAll('[data-login-role]');
      if (!links.length) return;

      function submitRoleLogin(role) {
        try {
          var form = document.createElement('form');
          form.method = 'POST';
          form.action = '<%= user_google_oauth2_omniauth_authorize_path %>';
          form.style.display = 'none';

          var token = document.querySelector('meta[name="csrf-token"]');
          if (token && token.content) {
            var csrf = document.createElement('input');
            csrf.type = 'hidden';
            csrf.name = 'authenticity_token';
            csrf.value = token.content;
            form.appendChild(csrf);
          }

          var roleField = document.createElement('input');
          roleField.type = 'hidden';
          roleField.name = 'role';
          roleField.value = role;
          form.appendChild(roleField);

          document.body.appendChild(form);
          form.submit();
        } catch (e) {
          console.error('Role login submit failed:', e);
        }
      }

      if (typeof window.__navbarSignInCleanup === 'function') {
        window.__navbarSignInCleanup();
        window.__navbarSignInCleanup = null;
      }

      var signInMenu = document.querySelector('[data-signin-menu]');
      var signInPanel = signInMenu ? signInMenu.querySelector('[data-signin-panel]') : null;
      var signInTrigger = signInMenu ? signInMenu.querySelector('[data-signin-trigger]') : null;
      var panelOpen = false;

      function closeSignInPanel() {
        if (!signInPanel || !signInTrigger) return;
        panelOpen = false;
        signInPanel.hidden = true;
        signInTrigger.setAttribute('aria-expanded', 'false');
      }

      function openSignInPanel() {
        if (!signInPanel || !signInTrigger) return;
        panelOpen = true;
        signInPanel.hidden = false;
        signInTrigger.setAttribute('aria-expanded', 'true');
      }

      if (signInTrigger && signInPanel) {
        signInTrigger.addEventListener('click', function (event) {
          event.preventDefault();
          panelOpen ? closeSignInPanel() : openSignInPanel();
        });

        var docClickHandler = function (event) {
          if (!signInMenu) return;
          if (!signInMenu.contains(event.target)) {
            closeSignInPanel();
          }
        };

        var keyHandler = function (event) {
          if (event.key === 'Escape') {
            closeSignInPanel();
          }
        };

        document.addEventListener('click', docClickHandler);
        document.addEventListener('keydown', keyHandler);

        document.addEventListener('turbo:before-cache', closeSignInPanel, { once: true });

        window.__navbarSignInCleanup = function () {
          document.removeEventListener('click', docClickHandler);
          document.removeEventListener('keydown', keyHandler);
        };

      } else {
        window.__navbarSignInCleanup = null;
      }

      links.forEach(function (a) {
        a.addEventListener('click', function (e) {
          e.preventDefault();
          var role = a.getAttribute('data-login-role');
          if (!role) return;
          closeSignInPanel();
          submitRoleLogin(role);
        });
      });
    }

    bootNavbarLogin();
  })();
</script>
