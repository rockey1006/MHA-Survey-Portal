<% question = question_fields.object %>
<div class="space-y-5 rounded-lg border border-slate-200 bg-white p-5 shadow-sm"
  data-question-fields-target="item">
  <%= question_fields.hidden_field :id %>
  <%= question_fields.hidden_field :_destroy, value: 0 %>

  <% question_type_value = question_fields.object.question_type.to_s %>
  <% supports_description = true %>

  <div class="flex flex-col gap-4 md:flex-row md:items-start md:justify-between">
    <div class="flex-1 space-y-2">
      <%= question_fields.label :question_text, "Prompt", class: "block text-sm font-medium text-slate-700" %>
      <%= question_fields.text_area :question_text,
            class: textarea_classes,
            placeholder: "Describe the competency being assessed." %>
      <% if supports_description %>
        <%= question_fields.label :description, "Question description (optional)", class: "block text-xs font-semibold uppercase tracking-wide text-slate-500" %>
        <%= question_fields.text_area :description, class: textarea_classes, placeholder: "Shown under the prompt for everyone completing the survey." %>
      <% end %>

      <%= question_fields.label :tooltip_text, "Tooltip text (optional)", class: "block text-xs font-semibold uppercase tracking-wide text-slate-500" %>
      <%= question_fields.text_area :tooltip_text, class: textarea_classes, placeholder: "Appears inside the tooltip icon when defined." %>
      <% tooltip_preview = question_fields.object.tooltip_text.to_s.strip.presence %>
      <% if tooltip_preview.present? %>
        <div class="flex items-center gap-2 text-xs text-slate-500">
          <span>Tooltip preview:</span>
          <%= render 'shared/question_tooltip', text: tooltip_preview %>
        </div>
      <% end %>
    </div>

    <button type="button" class="self-start rounded-lg bg-rose-50 px-3 py-2 text-sm font-semibold text-rose-600 hover:bg-rose-100" data-action="question-fields#remove">
      Remove question
    </button>
  </div>

  <div class="flex flex-wrap items-center gap-x-6 gap-y-4">
    <div class="flex min-w-[6rem] flex-col gap-1">
      <%= question_fields.label :question_order, "Display order", class: "block text-xs font-semibold uppercase tracking-wide text-slate-500" %>
      <%= question_fields.number_field :question_order, in: 1..200, class: input_classes %>
    </div>

    <div class="flex min-w-[12rem] flex-col gap-1">
      <%= question_fields.label :question_type, "Response type", class: "block text-xs font-semibold uppercase tracking-wide text-slate-500" %>
      <%= question_fields.select :question_type,
                options_for_select(@question_types.map { |type| [type.humanize, type] }, question_fields.object.question_type),
                {},
                class: input_classes %>
    </div>

    <div class="flex items-center gap-2 text-sm text-slate-700">
      <%= question_fields.check_box :is_required, class: checkbox_classes %>
      <%= question_fields.label :is_required, "Required response", class: "cursor-pointer select-none" %>
    </div>

    <div class="flex items-center gap-2 text-sm text-slate-700">
      <%= question_fields.check_box :has_evidence_field, class: checkbox_classes %>
      <%= question_fields.label :has_evidence_field, "Include evidence field", class: "cursor-pointer select-none" %>
    </div>
  </div>

  <div class="space-y-2">
    <%= question_fields.label :answer_options, "Answer options", class: "block text-sm font-medium text-slate-700" %>
    <%= question_fields.text_area :answer_options, class: textarea_classes, placeholder: "Comma separated values for multiple choice questions." %>
  </div>
</div>
