<!-- Main Content for Admin Dashboard - layout provides html/head/body and navbar -->
<main class="main-content main-content--dashboard">
  <%= render "shared/role_switcher" %>

  <section class="c-card c-card--hover dashboard-section">
    <div class="section-header">
      <h1 class="section-title">Admin Dashboard</h1>
      <p class="section-subtitle">System management for the MHA Program</p>
    </div>
    
    <div class="dashboard-grid dashboard-grid-4">
      <!-- Surveys -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to admin_surveys_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ“„</div>
          <div class="c-tile__title">Surveys</div>
          <div class="c-tile__description"><%= @total_surveys || 0 %> active</div>
        <% end %>
      </div>

      <!-- Target Levels -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to admin_target_levels_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ¯</div>
          <div class="c-tile__title">Target Levels</div>
          <div class="c-tile__description">Configure competency targets</div>
        <% end %>
      </div>

      <!-- Program Setup -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to admin_program_setup_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ§©</div>
          <div class="c-tile__title">Program Setup</div>
          <div class="c-tile__description">Tracks, majors, years, semesters</div>
        <% end %>
      </div>

      <!-- Reports -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to reports_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ“Š</div>
          <div class="c-tile__title">Reports</div>
          <div class="c-tile__description"><%= @total_reports || 0 %> generated</div>
        <% end %>
      </div>

      <!-- Students Records -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to student_records_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ‘¨â€ğŸ“</div>
          <div class="c-tile__title">Students Records</div>
          <div class="c-tile__description"><%= @role_counts[:student] || 0 %> registered</div>
        <% end %>
      </div>

      <!-- Manage Students -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to manage_students_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">âš™ï¸</div>
          <div class="c-tile__title">Manage Students</div>
          <div class="c-tile__description"><%= pluralize(@advisee_count, "assigned student") %></div>
        <% end %>
      </div>

      <!-- Members -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to manage_members_path, class: "c-tile__link" do %>
          <div class="c-tile__icon">ğŸ§‘â€ğŸ’¼</div>
          <div class="c-tile__title">Member Management</div>
          <div class="c-tile__description"><%= @role_counts[:advisor] || 0 %> advisors</div>
        <% end %>
      </div>

      <!-- View as Student/Advisor -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to new_impersonation_path, class: "c-tile__link" do %>
          <div class="c-tile__icon c-tile__icon--warning">ğŸ•µï¸</div>
          <div class="c-tile__title c-tile__title--warning">View as Student/Advisor</div>
          <div class="c-tile__description">Read-only preview</div>
        <% end %>
      </div>

      <!-- Maintenance Mode -->
      <div class="c-card c-card--interactive c-card--hover c-card--lift c-tile">
        <%= link_to admin_maintenance_path, class: "c-tile__link" do %>
          <div class="c-tile__icon c-tile__icon--warning">ğŸ› ï¸</div>
          <div class="c-tile__title c-tile__title--warning">Maintenance Mode</div>
          <div class="c-tile__description"><%= @maintenance_enabled ? "Enabled" : "Disabled" %></div>
        <% end %>
      </div>
    </div>
  </section>

  <section class="c-card c-card--hover dashboard-section md:px-12" style="margin-top: var(--spacing-4xl);">
    <div class="section-header">
      <h2 class="section-title">Recent Activity</h2>
      <p class="section-subtitle">Latest updates across surveys, feedback, and assignments</p>
    </div>

    <% if @recent_activity.present? %>
      <ul class="c-timeline">
        <% @recent_activity.each do |entry| %>
          <li class="c-timeline__item c-list-item" style="align-items: stretch;">
            <div aria-hidden="true" style="width: 48px; height: 48px; border-radius: 999px; background: var(--gray-50); border: 1px solid var(--gray-200); display: flex; align-items: center; justify-content: center; font-size: var(--font-size-xl); flex-shrink: 0;">
              <%= entry[:icon] || "ğŸ“Œ" %>
            </div>

            <div class="u-stack u-stack--sm" style="flex: 1; min-width: 0;">
              <p class="c-value" style="word-break: break-word;">
                <% if entry[:url].present? %>
                  <%= link_to entry[:title], entry[:url], class: "u-text-primary", style: "text-decoration: none;" %>
                <% else %>
                  <%= entry[:title] %>
                <% end %>
              </p>

              <% if entry[:subtitle].present? %>
                <p class="c-lede" style="margin-top: 0;"><%= entry[:subtitle] %></p>
              <% end %>
            </div>

            <div class="u-text-right" style="white-space: nowrap;">
              <p class="c-help" style="margin: 0;">
                <% if entry[:timestamp].present? %>
                  <span title="<%= l(entry[:timestamp], format: :long) %>"><%= time_ago_in_words(entry[:timestamp]) %> ago</span>
                <% else %>
                  <span>n/a</span>
                <% end %>
              </p>
            </div>
          </li>
        <% end %>
      </ul>
    <% else %>
      <div class="c-card c-card--tight c-card--dashed u-text-center u-stack u-stack--sm">
        <p class="c-value c-value--xl" aria-hidden="true">âœ¨</p>
        <p class="c-lede">No recent activity logged yet.</p>
      </div>
    <% end %>
  </section>
</main>