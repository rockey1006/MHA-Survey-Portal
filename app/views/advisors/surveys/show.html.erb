<main class="main-content">
  <section class="dashboard-section">
    <div class="section-header">
      <h1 class="section-title">Assign Survey</h1>
      <p class="section-subtitle">Survey #<%= @survey_number %>: <%= @survey.title %></p>
    </div>

    <% if @students.present? %>
      <div class="dashboard-grid dashboard-grid-3">
        <% @students.each do |student| %>
          <% assigned = @assigned_student_ids&.include?(student.student_id) %>

          <div class="feature-item">
            <div class="feature-icon" aria-hidden="true">ðŸŽ“</div>
            <div class="feature-title">
              <%= student.full_name.presence || student.email %>
            </div>
            <div class="feature-description"><%= student.email %></div>

            <div style="margin-top: 0.75rem; display:flex; gap:.5rem; flex-wrap:wrap;">
              <%= button_to "Assign to #{student.full_name.presence || student.email}",
                            assign_advisors_survey_path(@survey, student_id: student.student_id),
                            method: :post,
                            class: "btn",
                            data: { turbo_confirm: "Assign â€œ#{@survey.title}â€ to #{student.full_name.presence || student.email}?",
                                    confirm:       "Assign â€œ#{@survey.title}â€ to #{student.full_name.presence || student.email}?" },
                            disabled: assigned %>

              <%= button_to "Unassign from #{student.full_name.presence || student.email}",
                            unassign_advisors_survey_path(@survey, student_id: student.student_id),
                            method: :delete,
                            data: { turbo_confirm: "Are you sure you want to unassign â€œ#{@survey.title}â€ from #{student.full_name.presence || student.email}?",
                                    confirm:       "Are you sure you want to unassign â€œ#{@survey.title}â€ from #{student.full_name.presence || student.email}?" },
                            class: "btn btn-secondary",
                            disabled: !assigned %>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="feature-item" style="max-width: 560px; margin: 0 auto;">
        <div class="feature-icon" aria-hidden="true">ðŸ“­</div>
        <div class="feature-title">No advisees available</div>
        <div class="feature-description">Students assigned to you will appear here for survey assignment.</div>
      </div>
    <% end %>

    <div style="margin-top: 1rem;">
      <%= link_to "â† Back to Surveys", advisors_surveys_path %>
    </div>

    <div style="margin-top: 1rem;" class="flex justify-end">
      <%= button_to "Assign to all in this track",
                    assign_all_advisors_survey_path(@survey),
                    method: :post,
                    data: { turbo_confirm: "Assign â€œ#{@survey.title}â€ to ALL students in this track?",
                            confirm:       "Assign â€œ#{@survey.title}â€ to ALL students in this track?" },
                    class: "btn" %>
    </div>
  </section>
</main>
