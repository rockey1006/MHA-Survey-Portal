<% content_for :title, "Edit Student Profile" %>

<% full_name = @student.full_name.presence || @student.user&.name || "Student" %>
<% track = @student.track.present? ? @student.track.to_s.titleize : "Select a track" %>
<% major = @student.major.presence || "Add your program" %>
<% initials = full_name.split.first(2).map { |part| part.first&.upcase }.join.presence || "ST" %>

<main class="student-profile-edit-page px-4 py-10">
  <div class="student-profile-edit-container mx-auto max-w-6xl space-y-10">
    <section class="student-edit-hero">
      <div class="student-edit-hero__content">
        <div>
          <p class="student-edit-hero__eyebrow">Profile setup</p>
          <h1 class="student-edit-hero__title">Complete your student profile</h1>
          <p class="student-edit-hero__subtitle">
            Accurate details keep your advisor assignments and surveys aligned with your program path.
          </p>
          <div class="student-edit-hero__badges">
            <span class="hero-badge">
              <span class="hero-badge__dot"></span>
              Track · <%= track %>
            </span>
            <span class="hero-badge">
              Major · <%= major %>
            </span>
          </div>
        </div>
        <div class="student-edit-hero__avatar">
          <span><%= initials %></span>
        </div>
      </div>
    </section>

    <div class="student-edit-layout">
      <section class="student-edit-card">
        <header>
          <p class="eyebrow">Required sections</p>
          <h2>Identity & program details</h2>
        </header>

        <%= form_with model: @student, url: student_profile_path, method: :patch, local: true, class: "student-edit-form" do |form| %>
          <% if @student.errors.any? %>
            <div class="student-edit-alert">
              <h3>
                <%= pluralize(@student.errors.count, "error") %> need your attention before saving
              </h3>
              <ul>
                <% @student.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
            </div>
          <% end %>

          <div class="form-grid">
            <div class="form-field">
              <%= form.label :name, "Full name" %>
              <%= form.text_field :name, value: @student.user&.name,
                  placeholder: "John Doe",
                  required: true %>
            </div>

            <div class="form-field">
              <%= form.label :uin, "UIN" %>
              <%= form.text_field :uin,
                  placeholder: "Enter your 9-digit UIN",
                  required: true,
                  inputmode: "numeric",
                  autocomplete: "off",
                  maxlength: 9,
                  pattern: "\\d{9}" %>
              <small>Your 9-digit University ID</small>
            </div>

            <div class="form-field">
              <%= form.label :major, "Major / Program" %>
              <%= form.text_field :major,
                  placeholder: "Health Administration",
                  required: true %>
            </div>

            <div class="form-field">
              <%= form.label :track, "Program track" %>
              <%= form.select :track,
                  options_for_select([
                    ["Residential", "Residential"],
                    ["Executive", "Executive"]
                  ], @student.track),
                  { prompt: "Select your track" },
                  required: true %>
              <small>Pick the cohort you belong to</small>
            </div>

            <div class="form-field form-field--full">
              <%= form.label :advisor_id, "Advisor" %>
              <%= form.select :advisor_id,
                  options_from_collection_for_select(@advisors, :advisor_id, :name, @student.advisor_id),
                  { prompt: "Select your advisor (optional)" } %>
            </div>
          </div>

          <div class="form-actions">
            <%= link_to student_dashboard_path, class: "student-btn student-btn--ghost" do %>
              Cancel
            <% end %>
            <%= form.submit "Save profile", class: "student-btn student-btn--primary" %>
          </div>
        <% end %>
      </section>

      <aside class="student-edit-card student-edit-card--support">
        <header>
          <p class="eyebrow">Why we ask</p>
          <h2>Keep info fresh</h2>
        </header>
        <ul class="support-list">
          <li>We use your track to schedule the right survey cadence.</li>
          <li>Advisor selections unlock targeted reminders.</li>
          <li>UIN ensures records sync with TAMU systems.</li>
        </ul>
      </aside>
    </div>
  </div>
</main>
