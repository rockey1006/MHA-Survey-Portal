<details class="notifications-menu c-popover-anchor u-hover-dropdown">
  <summary class="c-icon-button c-icon-button--nav" aria-label="Notifications">
    <span class="c-icon-button__icon">
      <%= image_tag "notification-icon.png", alt: "", class: "notification-icon-img", aria: { hidden: true } %>
      <% if @unread_notification_count.to_i.positive? %>
        <span class="c-badge c-badge--count" aria-label="<%= @unread_notification_count %> unread notifications">
          <%= @unread_notification_count %>
        </span>
      <% end %>
    </span>
    <span class="sr-only">Notifications</span>
  </summary>

  <div class="c-popover c-popover--menu u-popover-down-right u-hover-dropdown__panel" role="menu">
    <div class="c-menu__header">
      <span class="c-menu__title">Recent Notifications</span>
      <%= link_to "View all", notifications_path, class: tailwind_button_classes(:ghost, extra_classes: "btn-sm") %>
    </div>

    <% if @recent_notifications.blank? %>
      <p class="c-menu__empty">No notifications yet.</p>
    <% else %>
      <ul class="c-menu">
        <% @recent_notifications.each do |notification| %>
          <li class="c-menu__item-wrap">
            <%= link_to(notification_path(notification), class: "c-menu__item") do %>
              <div class="c-menu__row">
                <span class="c-menu__item-title"><%= notification.title %></span>
                <time class="c-menu__meta" datetime="<%= notification.created_at.iso8601 %>"><%= time_ago_in_words(notification.created_at) %> ago</time>
              </div>
              <p class="c-menu__message"><%= truncate(notification.message, length: 80) %></p>
              <% unless notification.read? %>
                <span class="pill pill--primary">Unread</span>
              <% end %>
            <% end %>
          </li>
        <% end %>
      </ul>
    <% end %>

    <% if @unread_notification_count.to_i.positive? %>
      <div class="c-menu__footer">
        <%= button_to "Mark all as read",
                    mark_all_read_notifications_path,
                    method: :patch,
                    class: tailwind_button_classes(:secondary, extra_classes: "btn-sm") %>
      </div>
    <% end %>
  </div>
</details>
